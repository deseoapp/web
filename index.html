<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deseo - Plataforma de Micro-Deseos</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Mapbox GL JS -->
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
</head>
<body>
    <!-- Contenedor principal del layout -->
    <div class="app-container">
        <!-- Sidebar izquierdo -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-compass"></i>
                    <h1>outletbuddy</h1>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <div class="search-bar">
                <input type="text" placeholder="Search..." id="storeSearchInput">
                <button><i class="fas fa-search"></i></button>
            </div>

            <div class="filters">
                <div class="filter-group">
                    <span>Show me:</span>
                    <select id="showMeFilter">
                        <option value="openNow">Open Now</option>
                        <option value="all">All</option>
                    </select>
                </div>
                <div class="filter-group">
                    <span>Sort by:</span>
                    <select id="sortByFilter">
                        <option value="nearest">Nearest</option>
                        <option value="rating">Rating</option>
                    </select>
                </div>
                <button class="btn-filter" id="applyFiltersBtn"><i class="fas fa-filter"></i> Filters</button>
            </div>

            <div class="store-list" id="storeList">
                <!-- Store items will be dynamically loaded here -->
                <div class="store-item">
                    <div class="store-logo"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/20/Adidas_Logo.svg/2048px-Adidas_Logo.svg.png" alt="Adidas"></div>
                    <div class="store-info">
                        <h3>Adidas</h3>
                        <p>0.5 mi • <span class="open-status">Open 'til 6pm</span></p>
                    </div>
                    <div class="store-actions">
                        <i class="fas fa-heart"></i>
                    </div>
                </div>
                <div class="store-item">
                    <div class="store-logo"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a6/Nike_logo_black.svg/1200px-Nike_logo_black.svg.png" alt="Nike"></div>
                    <div class="store-info">
                        <h3>Nike</h3>
                        <p>0.7 mi • <span class="open-status">Open 'til 6pm</span></p>
                    </div>
                    <div class="store-actions">
                        <i class="fas fa-heart"></i>
                    </div>
                </div>
                <div class="store-item">
                    <div class="store-logo"><img src="https://cdn.icon-icons.com/icons2/2699/PNG/512/puma_logo_icon_169430.png" alt="Puma"></div>
                    <div class="store-info">
                        <h3>Puma</h3>
                        <p>0.3 mi • <span class="open-status">Open 'til 6pm</span></p>
                    </div>
                    <div class="store-actions">
                        <i class="fas fa-heart"></i>
                    </div>
                </div>
                <div class="store-item">
                    <div class="store-logo"><img src="https://seeklogo.com/images/U/under-armour-logo-545C664C33-seeklogo.com.png" alt="Under Armour"></div>
                    <div class="store-info">
                        <h3>Under Armour</h3>
                        <p>0.2 mi • <span class="open-status">Open 'til 6pm</span></p>
                    </div>
                    <div class="store-actions">
                        <i class="fas fa-heart"></i>
                    </div>
                </div>
                <div class="store-item">
                    <div class="store-logo"><img src="https://seeklogo.com/images/T/timberland-logo-B31F63489A-seeklogo.com.png" alt="Timberland"></div>
                    <div class="store-info">
                        <h3>Timberland</h3>
                        <p>0.4 mi • <span class="open-status">Open 'til 6pm</span></p>
                    </div>
                    <div class="store-actions">
                        <i class="fas fa-heart"></i>
                    </div>
                </div>
                <div class="store-item">
                    <div class="store-logo"><img src="https://www.ea7.com/on/demandware.static/-/Library-Sites-EA7SharedLibrary/default/dw10d54a2a/images/EA7_logo_black.svg" alt="EA7 Emporio Armani"></div>
                    <div class="store-info">
                        <h3>EA7 Emporio Armani</h3>
                        <p>2.1 mi • <span class="open-status">Open 'til 6pm</span></p>
                    </div>
                    <div class="store-actions">
                        <i class="fas fa-heart"></i>
                    </div>
                </div>
                <div class="store-item">
                    <div class="store-logo"><img src="https://logolook.net/wp-content/uploads/2023/04/Converse-Logo.png" alt="Converse"></div>
                    <div class="store-info">
                        <h3>Converse</h3>
                        <p>2.5 mi • <span class="open-status">Open 'til 6pm</span></p>
                    </div>
                    <div class="store-actions">
                        <i class="fas fa-heart"></i>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Área del mapa -->
        <main class="map-area">
            <div id="map" class="mapbox-map"></div>

            <!-- Tarjeta de detalles de la tienda (oculta por defecto) -->
            <div class="store-details-card" id="storeDetailsCard">
                <div class="card-header">
                    <div class="store-logo-small"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/20/Adidas_Logo.svg/2048px-Adidas_Logo.svg.png" alt="Adidas"></div>
                    <div class="store-info-small">
                        <h3>Adidas</h3>
                        <p>0.5 mi • <span class="open-status">Open 'til 6pm</span></p>
                    </div>
                    <div class="store-meta">
                        <span class="rating"><i class="fas fa-smile"></i> 100</span>
                        <span class="price-range">$$$$$</span>
                    </div>
                </div>
                <div class="card-body">
                    <h4>The largest Adidas store in the city</h4>
                    <p>Adidas is a German company, one of the world's leading sports goods manufacturers. It was founded in 1924 by the Dassler brothers as Dassler.</p>
                    <button class="btn-more-details">More Details</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Notificaciones y Modales (mantener existentes) -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- Modal de Autenticación (mantener tal cual) -->
    <div class="modal" id="authModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user"></i> Iniciar Sesión</h2>
                <button class="close-btn" onclick="closeAuthModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Tabs de login/registro -->
                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="switchAuthTab('login')">Iniciar Sesión</button>
                    <button class="auth-tab" onclick="switchAuthTab('register')">Registrarse</button>
                </div>
                
                <!-- Formulario de login -->
                <div id="loginForm" class="auth-form">
                    <form onsubmit="handleEmailLogin(event)">
                        <div class="form-group">
                            <label for="loginEmail">Correo:</label>
                            <input type="email" id="loginEmail" required>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">Contraseña:</label>
                            <input type="password" id="loginPassword" required>
                        </div>
                        <button type="submit" class="btn-primary">Iniciar Sesión</button>
                    </form>
                </div>
                
                <!-- Formulario de registro -->
                <div id="registerForm" class="auth-form" style="display: none;">
                    <form onsubmit="handleEmailRegister(event)">
                        <div class="form-group">
                            <label for="registerEmail">Correo:</label>
                            <input type="email" id="registerEmail" required>
                        </div>
                        <div class="form-group">
                            <label for="registerPassword">Contraseña:</label>
                            <input type="password" id="registerPassword" required>
                        </div>
                        <div class="form-group">
                            <label for="registerName">Nombre completo:</label>
                            <input type="text" id="registerName" required>
                        </div>
                        <button type="submit" class="btn-primary">Registrarse</button>
                    </form>
                </div>
                
                <!-- Divider -->
                <div class="auth-divider">
                    <span>o</span>
                </div>
                
                <!-- Google Sign-In -->
                <button class="btn-google" onclick="handleGoogleSignIn()">
                    <i class="fab fa-google"></i>
                    Continuar con Google
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para crear deseo con IA (mantener tal cual) -->
    <div class="modal" id="createWishModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Crear tu Deseo</h2>
                <button class="close-btn" id="closeCreateModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="ai-chat-container">
                    <div class="ai-chat-messages" id="aiChatMessages">
                        <div class="ai-message">
                            <div class="ai-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="message-content">
                                <p>¡Hola! Soy tu asistente de deseos. Cuéntame qué te gustaría que alguien haga por ti y te ayudo a crear el deseo perfecto con un precio justo.</p>
                            </div>
                        </div>
                    </div>
                    <div class="ai-chat-input">
                        <input type="text" id="aiChatInput" placeholder="Describe tu deseo...">
                        <button id="sendAiMessage">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
                <div class="wish-preview" id="wishPreview" style="display: none;">
                    <h3>Vista previa de tu deseo:</h3>
                    <div class="wish-card">
                        <h4 id="previewTitle"></h4>
                        <p id="previewDescription"></p>
                        <div class="wish-meta">
                            <span class="price" id="previewPrice"></span>
                            <span class="category" id="previewCategory"></span>
                        </div>
                    </div>
                    <button class="btn-primary" id="publishWish">Publicar Deseo</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para detalles del deseo (mantener tal cual) -->
    <div class="modal" id="wishDetailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="wishDetailsTitle"></h2>
                <button class="close-btn" id="closeDetailsModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="wish-details">
                    <p id="wishDetailsDescription"></p>
                    <div class="wish-meta">
                        <span class="price" id="wishDetailsPrice"></span>
                        <span class="category" id="wishDetailsCategory"></span>
                        <span class="location" id="wishDetailsLocation"></span>
                    </div>
                    <div class="wish-actions">
                        <button class="btn-secondary" id="viewDetailsBtn">Ver Detalles</button>
                        <button class="btn-primary" id="acceptWishBtn">Aceptar Deseo</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de chat privado (mantener tal cual) -->
    <div class="modal" id="privateChatModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Chat con <span id="chatUserName"></span></h2>
                <button class="close-btn" id="closeChatModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="private-chat-container">
                    <div class="chat-messages" id="privateChatMessages">
                        <!-- Mensajes del chat se generarán dinámicamente -->
                    </div>
                    <div class="chat-input">
                        <input type="text" id="privateChatInput" placeholder="Escribe tu mensaje...">
                        <button id="sendPrivateMessage">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
                <div class="chat-actions">
                    <button class="btn-success" id="completeWishBtn">Marcar como Completado</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de calificación (mantener tal cual) -->
    <div class="modal" id="ratingModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Califica la Experiencia</h2>
                <button class="close-btn" id="closeRatingModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="rating-container">
                    <div class="rating-status">
                        <h3>¿Se cumplió el deseo?</h3>
                        <div class="status-buttons">
                            <button class="btn-success" id="fulfilledBtn">Cumplido</button>
                            <button class="btn-danger" id="unfulfilledBtn">No Cumplido</button>
                        </div>
                    </div>
                    <div class="star-rating">
                        <h3>Calificación (1-5 estrellas)</h3>
                        <div class="stars" id="starRating">
                            <i class="fas fa-star" data-rating="1"></i>
                            <i class="fas fa-star" data-rating="2"></i>
                            <i class="fas fa-star" data-rating="3"></i>
                            <i class="fas fa-star" data-rating="4"></i>
                            <i class="fas fa-star" data-rating="5"></i>
                        </div>
                    </div>
                    <div class="comment-section">
                        <h3>Comentario (opcional)</h3>
                        <textarea id="ratingComment" placeholder="Cuéntanos sobre tu experiencia..."></textarea>
                    </div>
                    <button class="btn-primary" id="submitRating">Enviar Calificación</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de filtros (mantener tal cual) -->
    <div class="modal" id="filterModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Filtrar Deseos</h2>
                <button class="close-btn" id="closeFilterModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="filter-container">
                    <div class="filter-group">
                        <label>Precio máximo:</label>
                        <input type="range" id="priceFilter" min="0" max="1000" value="1000">
                        <span id="priceValue">$1000</span>
                    </div>
                    <div class="filter-group">
                        <label>Categoría:</label>
                        <select id="categoryFilter">
                            <option value="">Todas las categorías</option>
                            <option value="comida">Comida</option>
                            <option value="transporte">Transporte</option>
                            <option value="entretenimiento">Entretenimiento</option>
                            <option value="servicios">Servicios</option>
                            <option value="compras">Compras</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Distancia:</label>
                        <select id="distanceFilter">
                            <option value="5">5 km</option>
                            <option value="10">10 km</option>
                            <option value="25">25 km</option>
                            <option value="50">50 km</option>
                        </select>
                    </div>
                    <button class="btn-primary" id="applyFilters">Aplicar Filtros</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="config.js"></script>
    
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';
        
        // Inicializar Firebase
        if (CONFIG.FIREBASE.enabled) {
            const app = initializeApp(CONFIG.FIREBASE.config);
            const db = getFirestore(app);
            const auth = getAuth(app);
            const storage = getStorage(app);
            
            // Hacer disponible globalmente
            window.firebaseApp = app;
            window.firebaseDB = db;
            window.firebaseAuth = auth;
            window.firebaseStorage = storage;
            window.firebaseCollections = CONFIG.FIREBASE.collections;
            window.firebaseFunctions = { 
                collection, addDoc, getDocs, doc, updateDoc, deleteDoc,
                signInWithEmailAndPassword, createUserWithEmailAndPassword, 
                signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged,
                ref, uploadBytes, getDownloadURL
            };
            
            console.log('🔥 Firebase inicializado correctamente');
        }
    </script>
    
    <!-- No SDK needed - using REST API directly -->
    <script src="script-mapbox.js"></script>
</body>